 
  <page-header [title]="'Detection'"  >
  <app-time-selector
    [options]="timeFilterOptions"
    [title]="title"
    [selectedTime]="currentTime()"
    (timeChange)="onTimeChange($event)"
    (customSelected)="onCustomSelected($event)">
  </app-time-selector>
</page-header> 
<section >
  <div class="column-26">
    <mat-card class="radm-card">
      <mat-card-content>
        <div style="display: flex">
          <div style="width: 70%;">
            <h3 class="card-title" style="font-size: 22px; color: white;padding: 5px 0 0 5px ;">AI Alerts by Severity <mat-icon
              matTooltip="Distribution of AI alerts, detected by our model, ranked by severity"
              matTooltipPosition="above" matTooltipDelay="500">help_outline</mat-icon></h3>
          </div>
        </div>
        <div>
          <app-pie [graphOptions]="alertsBySevPie()" style="margin-top: 50px; flex-grow:1;"></app-pie>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  <div class="column-73">
    <mat-card class="radm-card">
      <mat-card-content>
        <div style="display: flex">
          <div style="width: 70%;">
            <h3 class="card-title" style="font-size: 22px; color: white;padding: 5px 0 0 5px ;">AI Alerts Trends<mat-icon
              matTooltip="Alerts trend generated by our AI model over the last selected time period"
              matTooltipPosition="above" matTooltipDelay="500">help_outline</mat-icon></h3>
          </div>
        </div>
        <div>
          <app-area [graphOptions]="alertsAreaGraphOptions()"
                    style="margin-top: 50px; flex-grow:1;"></app-area>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</section>
<section style="align-items: center;">
  <div class="column-26">
    <h3 class="graph-title card-title">Last 3 alerts - severity 1 <mat-icon
      matTooltip="The last 3 alerts detected by our AI model in the last selected time range - Severity 1"
      matTooltipPosition="above" matTooltipDelay="500">help_outline</mat-icon></h3>
    <mat-card class="radm-card no-bg">
      <mat-card-content>
        <div>
          <div style="display: flex; flex-direction: column; gap: 20px; justify-content: space-between;">
            @if(last3CriticalDeviances().length == 0) {
              <mat-card class="card-insights custom-card2">
                <mat-card-content class="card-content">
                  <div class="content-wrapper">
                    <div class="text-section">
                      <p class="title">No data found</p>
                      <p class="main-number">in the last selected time range</p>
                    </div>
                  </div>
                </mat-card-content>
              </mat-card>
            }
            @for (deviance of last3CriticalDeviances(); track $index) {
              <mat-card class="card-insights custom-card2">
                <mat-card-content class="card-content">
                  <div class="content-wrapper">
                    <div style="display:flex; flex-direction:column;  gap:10px;">
                      <div class="text-section">
                        <div class="title title-card">
                          <span>FLOW : {{deviance.flow_id}}</span>
                          <span>{{deviance.timestamp|date: 'yyyy-MM-dd HH:mm:ss': 'UTC' }}</span>
                        </div>
                      </div>
                      <div class="ips">
                        <div class="ip">
                                                <span class="title-span">Source IP <img
                                                  [src]="'assets/images/' + deviance?.src_geoip?.geo?.country_iso_code.toLowerCase()+ '.svg'"
                                                  alt="Source Country" class="country-ip"></span>
                          <span class="deviance-span">{{deviance.src_ip}}</span>
                        </div>
                        <div class="ip">
                                                <span class="title-span">Destination IP
                                                  @if(deviance?.dest_geoip?.geo?.country_iso_code) {
                                                    <img [src]="'assets/images/' + deviance?.dest_geoip?.geo?.country_iso_code.toLowerCase()+ '.svg'"
                                                          alt="Destination Country" class="country-ip">
                                                  }
                                                  @else {
                                                    <img [src]="'assets/images/fr.svg'" alt="Destination Country"
                                                          class="country-ip">

                                                  }</span>
                          <span class="deviance-span">{{deviance.dest_ip}}</span>

                        </div>
                      </div>
                      <p class="translation">{{deviance.translation}}</p>
                      <div class="stars">
                        <div class="confiance">
                          <p class="item-stats">Confidence</p><span [ngClass]="getSeverityClass(deviance.confiance)">{{getConfidence(deviance.confiance)}}</span>
                        </div>
                        <div class="severity">
                          <p class="item-stats">Deviance</p><span [ngClass]="getSeverityClass(deviance.confiance)">{{getDeviance(deviance.deviance)}}</span>
                        </div>
                        <div class="feedback">
                            <p class="item-stats">Feedback</p><span [ngClass]="deviance.feedback.value">{{deviance.feedback.value}}</span>
                        </div>
                      </div>
                      <div class="df">
                        <div></div>
                        <div class="cta">
                          <div class="choices">
                            <button mat-button extended class="call-to-action"
                                    (click)="redirectToDetailAlert(deviance)" matTooltip="View">
                              <mat-icon
                                class="icon-fd view">remove_red_eye</mat-icon></button>

                          </div>
                        </div>
                      </div>
                    </div>
                    <div>

                    </div>
                  </div>
                </mat-card-content>
              </mat-card>
            }

          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  <div class="column-74 areas">
    <mat-card class="radm-card">
      <mat-card-content>
        <div style="display: flex">
          <div style="width: 70%;">
            <h3 class="card-title" style="font-size: 22px; color: white;padding: 5px 0 0 5px ;">AI Alerts
              <mat-icon
                matTooltip="Geographical repartition of alerts based on source assets"
                matTooltipPosition="above" matTooltipDelay="500">help_outline</mat-icon></h3>
          </div>
        </div>
        <div>
          <app-world-map-marker [worldMapMarkerOptions]="mapOptions()"
                                style="height: 100%;"></app-world-map-marker>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</section>
<section >
  <div class="column-49">
    <mat-card class="radm-card">
      <mat-card-content>
        <div style="display: flex">
          <div style="width: 70%;">
            <h3 class="card-title" style="font-size: 22px; color: white;padding: 5px 0 0 5px ;">AI Anomalies Detection <mat-icon
              matTooltip="Distribution of abnormal traffic detected by our AI model over the last selected time period."
              matTooltipPosition="above" matTooltipDelay="500">help_outline</mat-icon></h3>
          </div>
        </div>
        <div>
          <app-areaspline [graphOptions]="abnormalAreaSplineChartOptions()"
                          style="margin-top: 50px; flex-grow:1;"></app-areaspline>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  <div class="column-50">
    <mat-card class="radm-card">
      <mat-card-content>
        <div style="display: flex">
          <div style="width: 70%;">
            <h3 class="card-title" style="font-size: 22px; color: white;padding: 5px 0 0 5px ;">Active Assets In The Last 2 Weeks <mat-icon
              matTooltip="Histogram of active assets on the network over the last 2 weeks"
              matTooltipPosition="above" matTooltipDelay="500">help_outline</mat-icon></h3>
          </div>
        </div>
        <div>
          <app-areaspline [graphOptions]="normalAreaSplineChartOptions()"
                          style="margin-top: 50px; flex-grow:1;"></app-areaspline>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</section>
<section>
  <div class="column-100">
    <mat-card class="radm-card">
      <mat-card-content>
        <div style="display: flex">
          <div style="width: 70%;">
            <h3 class="card-title" style="font-size: 22px; color: white;padding: 5px 0 0 5px ;">AI Alerts <mat-icon
              matTooltip="JizÃ´ AI detection by AI alert list, displayed in a customizable table"
              matTooltipPosition="above" matTooltipDelay="500">help_outline</mat-icon></h3>
          </div>
        </div>
        <div>
        <app-table
            [tableDataResponse]="_alert()"
            [tableColumns]="ordersTableColumns"
            [displayedColumns]="displayedColumns"
            [fields]="fields"
            [form]="form()"
            [length]="length"
            (tableActions)="tableActions($event)"
            (cellDatas)="getCellDatas($event)"
            [seeMore]="false" />
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</section> 